<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Prizm Browser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #f5f5f5;
        }

        #toolbar {
            padding: 8px;
            background-color: #2f3241;
            display: flex;
            align-items: center;
            -webkit-app-region: drag;
        }

        #nav-buttons {
            display: flex;
            margin-right: 10px;
        }

        .nav-btn {
            background: none;
            border: none;
            color: white;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 16px;
            -webkit-app-region: no-drag;
        }

        .nav-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        #url-bar {
            flex: 1;
            height: 30px;
            border: none;
            border-radius: 15px;
            padding: 0 15px;
            margin: 0 10px;
            outline: none;
            font-size: 14px;
            -webkit-app-region: no-drag;
        }

        #webview-container {
            flex: 1;
            position: relative;
        }

        webview {
            width: 100%;
            height: 100%;
            border: none;
        }

        #update-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            display: none;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <div id="toolbar">
        <div id="nav-buttons">
            <button id="back" class="nav-btn">←</button>
            <button id="forward" class="nav-btn">→</button>
            <button id="refresh" class="nav-btn">↻</button>
        </div>
        <input type="text" id="url-bar" placeholder="Enter URL or search term...">
        <button id="go" class="nav-btn">Go</button>
    </div>
    <div id="webview-container">
        <webview id="webview" src="https://www.google.com" style="display: inline-flex; width: 100%; height: 100%"></webview>
    </div>
    <div id="update-status">Update available! Restart to apply.</div>

    <script>
        const { ipcRenderer } = require('electron');
        const webview = document.getElementById('webview');
        const urlBar = document.getElementById('url-bar');
        const backBtn = document.getElementById('back');
        const forwardBtn = document.getElementById('forward');
        const refreshBtn = document.getElementById('refresh');
        const goBtn = document.getElementById('go');
        const updateStatus = document.getElementById('update-status');

        // Navigation controls
        backBtn.addEventListener('click', () => {
            if (webview.canGoBack()) webview.goBack();
        });

        forwardBtn.addEventListener('click', () => {
            if (webview.canGoForward()) webview.goForward();
        });

        refreshBtn.addEventListener('click', () => {
            webview.reload();
        });

        // URL handling
        function navigateToUrl() {
            let url = urlBar.value.trim();
            if (!url) return;
            
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }
            
            webview.src = url;
        }

        urlBar.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                navigateToUrl();
            }
        });

        goBtn.addEventListener('click', navigateToUrl);

        // Update webview URL in the address bar
        webview.addEventListener('did-navigate', (event) => {
            urlBar.value = event.url;
        });

        // Update navigation buttons
        webview.addEventListener('did-navigate', updateNavigationButtons);
        webview.addEventListener('did-navigate-in-page', updateNavigationButtons);

        function updateNavigationButtons() {
            backBtn.disabled = !webview.canGoBack();
            forwardBtn.disabled = !webview.canGoForward();
        }

        // Handle auto-update notifications
        ipcRenderer.on('update_available', () => {
            ipcRenderer.removeAllListeners('update_available');
            updateStatus.textContent = 'Downloading update...';
            updateStatus.style.display = 'block';
        });

        ipcRenderer.on('update_downloaded', () => {
            ipcRenderer.removeAllListeners('update_downloaded');
            updateStatus.textContent = 'Update available! Restart to apply.';
            updateStatus.style.display = 'block';
            
            // Auto-restart after 5 seconds
            setTimeout(() => {
                ipcRenderer.send('restart_app');
            }, 5000);
        });
    </script>
</body>
</html>
